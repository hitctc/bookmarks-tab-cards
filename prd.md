# PRD：Chrome 新标签页书签卡片插件（Bookmarks Tab Cards）

版本：v0.1
状态：开发中
目标读者：Owner / 协作者 / 相关方
最后更新：2026-01-05

---

## 0. 摘要（TL;DR）

* 这是一款 Chrome 新标签页（New Tab Override）插件：把新标签页替换为“书签卡片 + 搜索”。
* v0.1 只做 **浏览 + 搜索 + 打开**：不做书签管理、不做账号、不做服务端。
* 默认展示一个“入口文件夹”的书签卡片（建议默认：书签栏），搜索覆盖全部书签。
* 权限最小化：使用 `bookmarks` + `storage`；不申请 `host_permissions`。

---

## 1. 背景与问题陈述

### 1.1 背景

* 许多用户在 Chrome 打开新标签页（New Tab）时，希望快速进入“常用入口”，而书签是最稳定、可迁移的个人入口体系。
* Chrome 默认书签管理体验偏“树形管理”，不适合在新标签页做快速浏览与点击。
* 目标是用一个 New Tab 插件，将“书签浏览 + 搜索”变成打开浏览器后的默认效率入口。

### 1.2 当前痛点

* 痛点 1：默认新标签页信息密度低，无法作为高频工作入口。
* 痛点 2：书签在树形结构里查找成本高，尤其是收藏较多时。
* 痛点 3：书签搜索缺少“卡片化结果展示”，难以一眼识别目标站点（只看文本不够直观）。

### 1.3 机会与价值

* 机会：新标签页是最高频触达界面之一，将书签入口前置能显著提升访问效率。
* 价值（定性）：

  * 将书签从“管理工具”升级为“日常启动器”。
  * 降低寻找常用站点的认知与操作成本。
  
* 价值（可量化指标建议）：

  * 平均从打开新标签页到打开目标站点的点击次数 ≤ 2 次。
  * 书签搜索从输入到点击打开的平均耗时降低 30%+（对比原书签管理器）。

---

## 2. 产品定义

### 2.1 一句话定义

一个将 Chrome 新标签页替换为“书签卡片视图 + 搜索”的轻量插件，用于更快浏览与打开书签。

### 2.2 核心价值

* 价值 1：在新标签页以卡片形式高效浏览书签。
* 价值 2：支持即时搜索书签并快速打开。
* 价值 3：尽量轻量、低权限、无账号、无服务端依赖。

### 2.3 约束与假设（v0.1）

* 本地运行：无账号、无服务端、无埋点统计；仅使用 Chrome 本地书签数据。
* 最少权限：申请 `bookmarks`、`storage`；不申请 `host_permissions`。
* 不主动外联（默认）：页面打开时不主动请求第三方资源；卡片封面为纯本地“伪预览”（海报风格），不加载目标站点页面内容。
* 兼容与体验：支持系统深色模式（`prefers-color-scheme`）；窗口窄时布局自适应（不以移动端为目标，但不应“挤炸”）。

---

## 3. 目标与非目标

### 3.1 目标（Goals）

* G1：在新标签页展示书签，以卡片形式呈现（至少支持常用文件夹或根目录）。
* G2：提供书签搜索（按标题/URL），支持键盘快速操作（输入即搜、回车打开）。
* G3：保证加载速度与响应流畅（对上千书签规模可用）。
* G4：无需后端服务，所有数据来自 Chrome Bookmarks API。

### 3.2 非目标（Non-goals）

* NG1：不做完整书签管理能力（新增/编辑/移动/导入导出）作为 v0.1 的目标。
* NG2：不做跨浏览器支持（仅 Chrome/Chromium 系）。
* NG3：不做账户同步（依赖 Chrome 自身同步能力即可）。
* NG4：不做“服务端生成/同步”的站点截图能力（避免引入后端与隐私风险）。

### 3.3 v0.1 范围定义（MVP）

* 页面：New Tab Override 页面（单页），包含顶部搜索框与书签展示区域。
* 浏览：默认展示“入口文件夹”（建议默认：书签栏）下的**第一层**内容：
  * 书签：以卡片展示：
    * 16:9 封面区：纯本地伪预览（海报风格），包含 favicon、域名、标题与简化 URL 信息。
  * 文件夹：以“文件夹卡片”展示（标题、包含数量）；支持点击进入与面包屑返回（仅浏览，不提供增删改移动）。
* 搜索：覆盖全部书签（递归展开），按标题/URL/域名匹配；支持键盘上下选择与回车打开。
* 缓存：`chrome.storage.local` 缓存扁平化书签列表与必要索引字段，保证“秒开感”首屏。
* 设置（轻量）：入口文件夹选择、打开方式（当前标签/新标签）、主题（跟随系统/浅色/深色）、每行卡片数量（5~9，默认 5）。
* 明确不做：置顶/常用统计、标签体系、跨设备独立同步、书签管理（新增/编辑/移动）。

> 变更说明（2026-01-05）：
> - 移除“截图生成封面”能力；卡片封面改为纯本地伪预览（海报风格），不加载目标站点页面内容。

---

## 4. 用户画像与使用场景

### 4.1 用户画像（Persona）

* Persona A：重度浏览器用户/开发者/产品经理，收藏了大量资料站点，希望“打开新标签页就能像启动器一样点开常用网站”。
* Persona B：轻度用户，书签不多，但希望页面美观、清晰，一眼看到常用入口。
* Persona C：资料整理型用户，书签分文件夹管理，需要通过搜索快速定位。

### 4.2 核心使用场景（Top Scenarios）

1. 场景 1：用户打开新标签页，直接点击卡片打开常用站点。
2. 场景 2：用户输入关键词搜索书签，回车打开第一个匹配结果。
3. 场景 3：用户在书签较多时，通过搜索快速定位某个历史收藏链接。

---

## 5. 方案设计（高层）

### 5.1 设计原则

* 原则 1：轻量与快速加载优先（New Tab 必须“秒开感”）。
* 原则 2：最少权限原则（仅申请 `bookmarks`、`storage`；不采集、不上传；不申请 `host_permissions`）。
* 原则 3：以键盘效率为核心（搜索框自动聚焦、回车打开、上下选择）。
* 原则 4：卡片展示要有稳定识别信息（favicon > 标题兜底）。

### 5.2 信息架构 / 模块划分

* 模块清单：

  1. New Tab 页面容器（UI Shell）
  2. 书签数据层（Bookmarks Provider：读取/缓存/索引）
  3. 卡片视图（Cards View：渲染书签）
  4. 搜索模块（Search：输入、过滤、排序、快捷键）
  5. 设置模块（Settings，v0.1 可简化为本地配置）

* 职责边界：

  * 数据层只负责：

    * 调用 Chrome Bookmarks API 拉取数据
    * 建索引（标题/URL/域名）
    * 提供查询接口（给 UI 消费）
  * UI 层只负责：

    * 展示卡片
    * 接受输入与交互
    * 渲染搜索结果与打开链接

### 5.3 关键流程（Workflow）

* 流程 1：新标签页打开

  1. 页面加载（New Tab）
  2. 读取本地缓存（若存在）立刻渲染首屏
  3. 异步从 Bookmarks API 拉取最新数据
  4. 建索引并更新 UI（差量或全量刷新）

* 流程 2：搜索书签

  1. 搜索框默认聚焦
  2. 用户输入关键字 -> 实时过滤（debounce 80~150ms）
  3. 展示结果列表/卡片
  4. 回车打开 Top1；方向键切换选中项；Enter 打开选中项

* 流程 3：打开书签

  * 点击卡片 / 回车 -> 在当前标签页打开（默认）
    -（可选）按住 Ctrl/Meta 或提供设置 -> 新标签页打开

### 5.4 页面布局（建议）

* 顶部：入口文件夹下拉 + 搜索框（默认聚焦），可选放置 Logo/名称与设置入口。
* 中部：面包屑（当前文件夹路径）+ 卡片网格（书签卡片/文件夹卡片）；网格列数支持 3~9 可配置。
* 搜索态：输入非空时，卡片区域切换为“结果列表”（更适合键盘选择）；每行展示 favicon、标题、域名，并弱化显示 folderPath。
* 状态提示：加载中、错误、无结果等提示尽量简短，不打扰操作。

### 5.5 交互与快捷键（v0.1）

* 自动聚焦：打开新标签页后，搜索框自动聚焦；输入即搜（debounce 80~150ms）。
* 键盘：
  * `↑` / `↓`：切换选中结果
  * `Enter`：打开选中结果（无选中时打开 Top1）
  * `Esc`：清空输入并返回卡片视图
  * `Ctrl/Cmd + K`：随时聚焦搜索框
  * `Ctrl/Cmd + Enter`：强制新标签打开（若实现；否则依赖浏览器默认 `Ctrl/Cmd + Click`）
* 鼠标：
  * 左键点击：在当前标签打开
  * `Ctrl/Cmd + Click` / 中键：由浏览器默认在新标签打开（尽量不需要额外权限）

### 5.6 空态 / 错态 / 兜底

* 加载态：优先读缓存立刻渲染；同时后台刷新书签树并更新 UI。
* 空态：
  * 入口文件夹为空：提示“去书签栏添加常用网站”，给出简单引导。
  * 搜索无结果：展示“未找到”，并保留输入。
* 错态：
  * 读取书签失败：展示可重试按钮 + 简短原因；同时在 console 输出中文日志，方便排查。
* favicon 兜底：取不到 favicon 时展示域名首字母/纯色图标，保证卡片稳定可识别。

---

## 6. 数据与接口（如适用）

### 6.1 数据结构

* Bookmarks Tree Node（来自 Chrome API，抽象字段，实际类型为 `chrome.bookmarks.BookmarkTreeNode`）：

  * id: string
  * parentId?: string
  * index?: number（同级排序）
  * title: string
  * url?: string（存在则为书签）
  * children?: Node[]（存在则为文件夹）
  * dateAdded?: number
  * dateGroupModified?: number（文件夹变更时间，存在时可用于粗粒度判断是否需要重建索引）
* 插件内部索引结构（建议）：

  * BookmarkIndexItem（扁平化，供渲染与搜索使用）：

    * id
    * parentId
    * title
    * url
    * folderPath（例如：`工具/前端/文档`）
    * domain（从 url 解析）
    * faviconUrl（优先 `chrome://favicon2/?size=64&page_url=...`，失败则走本地图标兜底）
    * searchText（预先拼接好的可搜索字符串：title + domain + url + folderPath，统一小写/去空白）

> 可选：把内部结构写成 TypeScript 接口，后续实现时可直接照搬。

```ts
interface BookmarkIndexItem {
  id: string;
  parentId?: string;
  title: string;
  url: string;
  folderPath: string;
  domain: string;
  faviconUrl: string;
  searchText: string;
}

interface BookmarkCachePayload {
  schemaVersion: 1;
  generatedAt: number;
  entryFolderId: string;
  items: BookmarkIndexItem[];
}
```

### 6.2 接口清单

> Chrome Extension API（Manifest V3）

| 名称                                      | 方向 | 入参           | 出参    | 备注                |
| --------------------------------------- | -- | ------------ | ----- | ----------------- |
| chrome.bookmarks.getTree                | 读  | 无            | 书签树   | 全量读取              |
| chrome.bookmarks.onCreated/onRemoved/onChanged | 读  | callback     | 事件    | v0.2（可选）：监听书签变更 |
| chrome.bookmarks.search                 | 读  | query string | 匹配列表  | 可作为 fallback（不建议依赖它做主搜索，排序与可控性较弱） |
| chrome.storage.local.get/set            | 读写 | key/value    | value | 缓存索引与设置           |

> 打开链接策略（优先）：使用浏览器默认跳转（`<a href>` / `window.location` / `window.open`），并保留 Ctrl/Cmd+Click 等浏览器默认行为。

### 6.3 索引与搜索策略（建议）

* 扁平化：启动时把书签树递归展开为 `BookmarkIndexItem[]`，仅保留“书签叶子节点”（`url` 存在）。
* 预处理：为每条书签预计算 `domain`、`folderPath`、`searchText`（统一小写、去多余空白）。
* 查询：对 `searchText.includes(keyword)` 做快速过滤；再按简单规则排序，保证“更可能的命中更靠前”：
  * title 前缀命中 > title 包含命中 > domain 命中 > url 命中
  * 同分时保持书签原始顺序（等价于用户在书签管理器中的排序）
* 性能：输入 debounce 80~150ms；结果上限（例如 50~200）避免一次渲染过多 DOM。

### 6.4 缓存与一致性策略（建议）

* 缓存目标：让 New Tab 有“秒开感”，优先展示上次构建的 `items`。
* 缓存位置：`chrome.storage.local`，按 `schemaVersion` 做版本隔离，便于后续升级。
* 更新策略：
  * 打开页面：先读缓存渲染 -> 后台调用 `chrome.bookmarks.getTree` -> 重建索引 -> 更新 UI 与缓存。
  * v0.1 可接受“刷新触发更新”；v0.2 再考虑监听 `chrome.bookmarks.onCreated/onRemoved/onChanged` 做增量更新。
* 存储控制：只缓存必要字段，避免超出 storage 配额；大字段（如全文倒排索引）不建议落盘。

### 6.5 权限与隐私说明（建议写进 README/商店描述）

* 权限清单（v0.1）：
  * `bookmarks`：读取/搜索本地书签
  * `storage`：缓存索引与保存用户设置
* 隐私承诺：
  * 不采集、不上传任何用户数据（包含书签内容与使用行为）
  * 默认不主动发起第三方网络请求；页面不加载目标站点页面内容

---

## 7. 验收标准（Acceptance Criteria）

### 7.1 功能验收

* AC1：安装插件后，新标签页被替换为插件页面，打开无报错。
* AC2：默认展示“入口文件夹”的第一层内容；书签以卡片展示，包含 16:9 海报封面（含标题与 URL 信息）。
* AC2.1：图标区显示优先级：favicon > 标题兜底。
* AC3：文件夹以“文件夹卡片”展示；点击可进入，面包屑可返回上一级（仅浏览）。
* AC4：搜索框默认聚焦；输入关键字后能实时更新结果；空输入时展示默认卡片列表。
* AC5：搜索同时匹配标题与 URL（含域名）；结果列表支持 `↑/↓` 选择，`Enter` 打开选中项，`Esc` 清空并退出搜索态。
* AC6：点击书签卡片可打开对应 URL；`Ctrl/Cmd + Click` 或中键遵循浏览器默认在新标签打开。
* AC7：书签变更后刷新页面能看到最新书签（v0.1 可接受“刷新触发更新”）。
* AC8：有缓存时，打开新标签页能先渲染缓存内容，再异步刷新为最新书签数据。
* AC9：设置可保存并生效（至少包含：入口文件夹选择、主题、默认打开方式、每行卡片数量 5~9）。

### 7.2 质量验收

* 性能：

  * 首屏可交互时间（TTI）目标 ≤ 1s（中等书签量：~1000 条）
  * 5000 条书签规模下搜索仍可用（无明显卡顿，结果更新 < 500ms）
* 兼容性：

  * Chrome Stable（Windows/macOS/Linux）可用
  * Manifest V3 合规
  * 深色模式可用（跟随系统时表现正确，文本对比度可读）
* 隐私与安全：
  * 默认不主动发起第三方网络请求；页面不加载目标站点页面内容
  * 权限遵循最小化原则（`bookmarks` + `storage`；不申请 `host_permissions`）
* 可维护性：

  * 数据层与 UI 层解耦，存在清晰模块边界
  * 核心逻辑具备最小单元测试或可验证脚本（可选）

---

## 8. 风险与对策

* 风险 1：书签量巨大导致索引与渲染性能问题

  * 对策：虚拟列表（v0.2）、debounce、分批渲染、缓存索引、只渲染可见区域。
* 风险 2：favicon 获取策略不稳定或跨域限制

  * 对策：优先使用 `chrome://favicon2/`（仅扩展页面可用）；其次尝试 `${origin}/favicon.ico`；仍失败则兜底为纯文本域名徽标。
* 风险 3：Manifest V3 权限与 CSP 约束导致资源加载受限

  * 对策：遵循 MV3 规范，避免远程脚本；资源本地化；严格权限声明。
* 风险 4：用户期望“书签管理能力”扩大需求范围

  * 对策：v0.1 明确只做浏览+搜索；后续以 v0.2/v1.0 规划增量能力。
* 风险 5：`chrome.storage.local` 配额限制导致缓存失败

  * 对策：只缓存必要字段；必要时做分页/截断；引入 `schemaVersion`，升级时可平滑清理旧缓存。
* 风险 6：New Tab Override 与其他同类插件冲突（用户只能启用一个）

---

## 9. 里程碑计划

| 里程碑                  | 交付物                          | 截止时间 | 负责人   |
| -------------------- | ---------------------------- | ---- | ----- |
| M1：原型可用（v0.1-alpha）  | New Tab 页面 + 书签卡片展示（无搜索或弱搜索） | TBD  | Owner |
| M2：核心功能完成（v0.1-beta） | 搜索、键盘交互、打开链接策略、基础样式          | TBD  | Owner |
| M3：可发布（v0.1）         | 性能优化、缓存、错误兜底、README、打包发布     | TBD  | Owner |

> 注：你可在氛围编程时把 TBD 改成具体日期，并将任务拆成 GitHub Issues。

---

## 10. 附录

* 相关链接：

  * [Chrome Extensions（Manifest V3）文档](https://developer.chrome.com/docs/extensions/)
  * [chrome_url_overrides（New Tab Override）](https://developer.chrome.com/docs/extensions/reference/manifest/chrome_url_overrides/)
  * [Bookmarks API](https://developer.chrome.com/docs/extensions/reference/api/bookmarks)
  * [Storage API](https://developer.chrome.com/docs/extensions/reference/api/storage)
* 术语表：

  * New Tab Override：通过扩展替换浏览器新标签页内容
  * Bookmarks API：Chrome 扩展读取/搜索书签的接口
  * Debounce：对频繁输入进行延迟合并，降低计算与渲染压力
  * Virtual List：只渲染可视区域列表项以提升性能

---

## 11. 未决问题（实现前确认）

* 默认入口文件夹：默认用“书签栏”是否符合预期？是否允许用户选择并记忆上次打开的文件夹？
* 浏览深度：v0.1 允许进入多级文件夹到任意深度，还是只做 1~2 级？
* 搜索展示：搜索结果用列表（键盘友好）还是仍用网格卡片？folderPath 展示到什么程度不干扰阅读？
* 网格列数：默认每行卡片数量是多少更舒服（5/6/7）？是否需要对窄窗口自动降列？
* 书签更新：v0.1 仅刷新更新是否足够？是否要在 v0.1 就监听 bookmarks 变更事件（复杂度会上升）？

